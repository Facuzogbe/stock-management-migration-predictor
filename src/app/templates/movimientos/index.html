<!-- src/app/templates/movimientos/index.html -->
{% extends "base.html" %}

{% block title %}Movimientos{% endblock %}

{% block content %}
<h2>Historial de Movimientos</h2>
<a href="{{ url_for('movimientos.nuevo_movimiento') }}">Registrar nuevo movimiento</a>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <ul>
        {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
{% endwith %}

<table class="table">
  <thead>
      <tr>
          <th>ID</th>  <!-- Nueva columna -->
          <th>Fecha</th>
          <th>Producto</th>
          <th>Tipo</th>
          <th>Cantidad</th>
      </tr>
  </thead>
  <tbody>
      {% for movimiento in movimientos %}
      <tr>
          <td>{{ movimiento.id }}</td>  <!-- Muestra el ID autogenerado -->
          <td>{{ movimiento.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
          <td>
              {% if movimiento.producto %}
                  {{ movimiento.producto.product_name }} ({{ movimiento.producto.sku }})
              {% else %}
                  <span class="text-danger">Producto eliminado</span>
              {% endif %}
          </td>
          <td>
              {% if movimiento.tipo == 'entrada' %}
                  <span class="badge bg-success">Entrada</span>
              {% else %}
                  <span class="badge bg-danger">Salida</span>
              {% endif %}
          </td>
          <td>{{ movimiento.cantidad }}</td>
      </tr>
      {% endfor %}
  </tbody>
</table>
  
  <a href="{{ url_for('movimientos.nuevo_movimiento') }}" class="btn btn-primary mt-3">Registrar nuevo movimiento</a>
  
{% endblock %}
